<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cluster Live Maps</title>
    <link href="https://fonts.googleapis.com/css2?family=Acme&display=swap" rel="stylesheet">
    
    <style>
        /* Farben und Schriftarten */
        :root {
            --color-red: #E53935; /* Feuerrot */
            --color-dark: rgba(20, 20, 20, 0.95);
            --color-text: #f7f7f7;
            --color-light-dark: rgba(30, 30, 30, 0.95);
            --color-gold: #FFEB3B;
            --sidebar-width: 260px;
            
            --font-main: sans-serif;
            --font-header: 'Acme', var(--font-main);
        }

        body {
            background-color: transparent;
            font-family: var(--font-main);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            min-height: 100vh; 
            box-sizing: border-box;
            overflow-y: auto; 
        }

        /* Hauptcontainer */
        .map-widget-container {
            background-color: var(--color-dark);
            border-radius: 12px;
            border: 3px solid var(--color-red);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.8);
            width: 100%;
            max-width: 1800px;
            height: auto; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            margin-bottom: 50px; 
        }

        /* Header */
        .main-page-header {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-red);
            font-family: var(--font-header);
            text-transform: uppercase;
            text-align: center;
            padding: 10px 0;
            margin: 0;
            text-shadow: 0 0 20px rgba(229, 57, 53, 0.4);
            border-bottom: 2px solid var(--color-red);
            background-color: rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        /* Layout Wrapper */
        .map-body-wrapper {
            display: flex;
            flex-direction: row;
            align-items: stretch; 
        }

        /* --- Sidebar --- */
        .map-sidebar {
            width: var(--sidebar-width);
            background-color: rgba(0, 0, 0, 0.4);
            border-right: 2px solid var(--color-red);
            display: flex;
            flex-direction: column;
            min-height: 800px; 
            flex-shrink: 0;
        }

        .sidebar-content-sticky {
            position: sticky;
            top: 0;
            max-height: 100vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--color-red) transparent;
        }

        .sidebar-content-sticky::-webkit-scrollbar { width: 6px; }
        .sidebar-content-sticky::-webkit-scrollbar-thumb { background-color: var(--color-red); border-radius: 3px; }

        .sidebar-header {
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid var(--color-red);
            background-color: rgba(229, 57, 53, 0.1);
        }

        .sidebar-title {
            font-family: var(--font-header);
            font-size: 1.2rem;
            color: var(--color-text);
            text-transform: uppercase;
            margin: 0;
        }

        .group-header {
            padding: 10px 15px 5px 15px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--color-red);
            text-transform: uppercase;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            margin-top: 10px;
            font-family: var(--font-header);
        }
        .group-header:first-child { margin-top: 0; }

        .map-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 10px 15px;
            text-align: left;
            cursor: pointer;
            font-size: 0.95rem;
            font-family: var(--font-main);
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            width: 100%; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box; 
        }

        .map-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: #fff;
            padding-left: 20px; 
        }

        .map-btn.active {
            background-color: rgba(229, 57, 53, 0.15);
            color: #fff;
            border-left-color: var(--color-red);
            font-weight: 600;
        }

        .status-dot {
            height: 6px;
            width: 6px;
            background-color: #4CAF50; 
            border-radius: 50%;
            box-shadow: 0 0 5px #4CAF50;
            flex-shrink: 0; 
        }

        /* --- Content Area --- */
        .content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #121212;
            width: calc(100% - var(--sidebar-width)); 
        }

        /* 1. Map Bereich (VERGRÖSSERT) */
        .iframe-container {
            width: 100%;
            height: 85vh; 
            min-height: 600px;
            position: relative;
            background-color: #000;
            border-bottom: 3px solid var(--color-red);
            flex-shrink: 0; 
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* 2. POI Bereich */
        .poi-section {
            background-color: var(--color-light-dark);
            padding: 20px;
            box-sizing: border-box;
            min-height: 300px; 
        }

        /* Kategorie Header */
        .poi-category-header {
            font-family: var(--font-header);
            font-size: 1.1rem;
            color: var(--color-gold);
            margin-bottom: 10px;
            margin-top: 15px;
            padding-left: 10px;
            border-left: 4px solid var(--color-red);
            text-transform: uppercase;
        }
        .poi-category-header:first-child { margin-top: 0; }

        /* Slider Wrapper */
        .poi-slider-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        /* Horizontaler Slider */
        .poi-slider {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 5px; 
            scroll-behavior: smooth;
            width: 100%;
            -ms-overflow-style: none;  
            scrollbar-width: none; 
        }
        
        .poi-slider::-webkit-scrollbar { display: none; }

        /* Pfeile */
        .slider-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--color-red);
            border-radius: 50%;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s ease;
            user-select: none;
            font-size: 1.2rem;
            font-weight: bold;
            opacity: 0.8;
            display: none; 
        }

        .slider-arrow:hover {
            background-color: var(--color-red);
            box-shadow: 0 0 10px rgba(229, 57, 53, 0.6);
            opacity: 1;
        }

        .slider-arrow.prev { left: -15px; }
        .slider-arrow.next { right: -15px; }
        
        @media (max-width: 768px) {
            .slider-arrow { display: none; } 
        }

        /* POI Card Styling */
        .poi-card {
            flex: 0 0 240px; 
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, border-color 0.2s;
            display: flex;
            flex-direction: column;
            cursor: pointer; /* Zeigt an, dass es klickbar ist */
        }

        .poi-card:hover {
            transform: translateY(-3px);
            border-color: var(--color-red);
            box-shadow: 0 4px 15px rgba(229, 57, 53, 0.3);
        }

        .poi-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-bottom: 1px solid var(--color-red);
        }

        .poi-info {
            padding: 12px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .poi-title {
            font-family: var(--font-header);
            font-size: 1rem;
            color: #fff;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .poi-coords {
            font-size: 0.85rem;
            color: var(--color-gold);
            font-weight: bold;
        }
        
        .poi-subtext {
             font-size: 0.75rem;
             color: rgba(255,255,255,0.6);
             margin-top: 2px;
        }

        /* MODAL (LIGHTBOX) STYLES */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none; /* Standard aus */
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--color-light-dark);
            border: 2px solid var(--color-red);
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 30px rgba(229, 57, 53, 0.5);
            display: flex;
            flex-direction: column;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .modal-close-btn:hover {
            background: var(--color-red);
        }

        .modal-image {
            width: 100%;
            max-height: 70vh;
            object-fit: contain;
            background-color: black;
            border-bottom: 2px solid var(--color-red);
        }

        .modal-details {
            padding: 20px;
            text-align: center;
        }

        .modal-title {
            font-family: var(--font-header);
            font-size: 1.8rem;
            color: var(--color-text);
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .modal-type {
            color: var(--color-red);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 1rem;
            margin-bottom: 10px;
            display: block;
        }

        .modal-coords {
            font-size: 1.2rem;
            color: var(--color-gold);
            font-weight: bold;
            background: rgba(0,0,0,0.3);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* Lade-Animation */
        .loader {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 50px; height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 5px solid var(--color-red);
            animation: spin 1s linear infinite;
            z-index: 5;
            display: none; 
        }

        @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

        /* Responsive */
        @media (max-width: 900px) {
            .map-body-wrapper { flex-direction: column; }
            .map-sidebar { width: 100%; min-height: auto; border-right: none; border-bottom: 3px solid var(--color-red); }
            .sidebar-content-sticky { position: static; max-height: 300px; }
            .iframe-container { height: 500px; }
            .content-area { width: 100%; }
        }
    </style>
</head>
<body>

    <!-- MODAL OVERLAY (Lightbox) -->
    <div id="poiModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close-btn" onclick="closeModal(event)">×</button>
            <img id="modalImg" src="" alt="" class="modal-image">
            <div class="modal-details">
                <span id="modalType" class="modal-type"></span>
                <div id="modalTitle" class="modal-title"></div>
                <div id="modalCoords" class="modal-coords"></div>
            </div>
        </div>
    </div>

    <div class="map-widget-container">
        <div class="main-page-header">Kartographie</div>

        <div class="map-body-wrapper">
            <!-- Sidebar Navigation -->
            <div class="map-sidebar">
                <div class="sidebar-content-sticky" id="mapSidebar">
                    <!-- Wird per JS gefüllt -->
                </div>
            </div>

            <!-- Rechter Content Bereich -->
            <div class="content-area">
                <!-- Live Map -->
                <div class="iframe-container">
                    <div id="loader" class="loader"></div>
                    <iframe id="mapFrame" src="" allowfullscreen></iframe>
                </div>

                <!-- Points of Interest -->
                <div class="poi-section" id="poiSection" style="display: none;">
                    <div id="poiContainer">
                        <!-- Hier werden die Slider pro Kategorie generiert -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATENBANK
        const mapData = {
            "official": [
                {
                    name: "The Island",
                    url: "https://arkmap.axi92.at/f1df34b8-fb4e-4411-8f10-d16502d5534a",
                    pois: [
                        { title: "Öffentliche Harzfarm", type: "Teleporter", coords: "Lat: 61 / Lon: 49.5", img: "https://i.postimg.cc/xTv4jhTV/Bild-2024-05-16-133412340.png" },
                        { title: "Grüner Obelisk", type: "Teleporter", coords: "Lat: 59.5 / Lon: 77.5", img: "https://i.postimg.cc/QxRFgPjn/Bild-2024-05-16-130443256.png" },
                        { title: "Roter Obelisk", type: "Teleporter", coords: "Lat: 85.5 / Lon: 13", img: "https://i.postimg.cc/hvzhbVvV/Bild-2024-05-16-133733722.png" },
                        { title: "Blauer Obelisk", type: "Teleporter", coords: "Lat: 22 / Lon: 21", img: "https://i.postimg.cc/DzCbFvbp/Bild-2024-05-16-132500159.png" },
                        { title: "Lava Cave", type: "Artefakt", sub: "Gewaltigen/Massive", coords: "Lat: 74 / Lon: 92", img: "https://i.postimg.cc/Fsfddxfy/Bild-2024-06-30-171335914.png" },
                        { title: "Lower South Cave", type: "Artefakt", sub: "Jägers/Hunter", coords: "Lat: 85 / Lon: 54", img: "https://i.postimg.cc/1tWM08Mp/Bild-2024-06-30-171919385.png" },
                        { title: "Swamp Cave", type: "Artefakt", sub: "Immunen/Immune", coords: "Lat: 65 / Lon: 35", img: "https://i.postimg.cc/cHG4DrS6/Bild-2024-06-30-175803492.png" },
                        { title: "Snow Cave", type: "Artefakt", sub: "Stärke/Strong", coords: "Lat: 26 / Lon: 29", img: "https://i.postimg.cc/MKQKV7RV/Bild-2024-06-30-181533870.png" },
                        { title: "North West Cave", type: "Artefakt", sub: "Himmelsherren/Skylord", coords: "Lat: 14 / Lon: 14", img: "https://i.postimg.cc/zfCjdz2p/Bild-2024-06-30-190654637.png" },
                        { title: "North East Cave", type: "Artefakt", sub: "Fressers/Devourer", coords: "Lat: 9 / Lon: 91", img: "https://i.postimg.cc/SQnHQ8nM/Bild-2024-06-30-185632249.png" },
                        { title: "Upper South Cave", type: "Artefakt", sub: "Rudels/Pack", coords: "Lat: 71 / Lon: 57", img: "https://i.postimg.cc/brjVqq3F/Bild-2024-06-30-193806399.png" },
                        { title: "Caverns of Lost Hope", type: "Artefakt", sub: "List/Devious", coords: "Lat: 45 / Lon: 98", img: "https://i.postimg.cc/hv9qbSC9/Bild-2024-06-30-194923321.png" },
                        { title: "Caverns of Lost Faith", type: "Artefakt", sub: "Brute", coords: "Lat: 53 / Lon: 3", img: "https://i.postimg.cc/4yrQZGZF/Bild-2024-06-30-195311581.png" },
                        { title: "Central Cave", type: "Artefakt", sub: "Schlauen/Clever", coords: "Lat: 40.5 / Lon: 46", img: "https://i.postimg.cc/Y9xK2yW6/Bild-2024-07-01-204126849.png" },
                        { title: "Tek Cave", type: "Boss Arena", sub: "Terminal", coords: "Lat: 42 / Lon: 37", img: "https://i.postimg.cc/Sxrsxcw4/Bild-2024-06-30-184412268.png" }
                    ]
                },
                { 
                    name: "The Center", 
                    url: "https://arkmap.axi92.at/5205c82b-ddc6-465c-a43e-2a1cfc395fad", 
                    pois: [
                        { title: "Öffentliche Harzfarm", type: "Teleporter", coords: "Lat: 77.5 / Lon: 44.5", img: "https://i.postimg.cc/DyywMZjJ/Bild-2024-06-06-190132220.png" },
                        { title: "Grüner Obelisk", type: "Teleporter", coords: "Lat: 36 / Lon: 14.5", img: "https://i.postimg.cc/tT2Kch4Y/Bild-2024-06-06-192019904.png" },
                        { title: "Roter Obelisk", type: "Teleporter", coords: "Lat: 12 / Lon: 55", img: "https://i.postimg.cc/Kv7ffmqH/Bild-2024-06-06-191335394.png" },
                        { title: "Blauer Obelisk", type: "Teleporter", coords: "Lat: 51 / Lon: 75", img: "https://i.postimg.cc/85wWvYXj/Bild-2024-06-06-191041579.png" },
                        { title: "Lava Cave", type: "Artefakt", sub: "Gewaltigen/Massive", coords: "Lat: 15 / Lon: 62.7", img: "https://i.postimg.cc/Vv4vB18p/Bild-2024-07-30-190739432.png" },
                        { title: "Lava Oasis Cave", type: "Artefakt", sub: "Jägers/Hunter", coords: "Lat: 20 / Lon: 46", img: "https://i.postimg.cc/6QmmqbmX/Bild-2024-07-30-192204921.png" },
                        { title: "Lava Cave (Strong)", type: "Artefakt", sub: "Starken/Strong", coords: "Lat: 18.8 / Lon: 57.4", img: "https://i.postimg.cc/GhVcZrRF/Bild-2024-07-30-193716409.png" },
                        { title: "The Center Cave", type: "Artefakt", sub: "Hinterhältigen/Devious", coords: "Lat: 41.7 / Lon: 27.4", img: "https://i.postimg.cc/NjCHbTsY/Bild-2024-07-30-212542107.png" },
                        { title: "Cliffside Cavern", type: "Artefakt", sub: "List/Cunning", coords: "Lat: 36.5 / Lon: 12.5", img: "https://i.postimg.cc/GpZPqRkg/Bild-2024-07-30-201506191.png" },
                        { title: "North Ice Cave", type: "Artefakt", sub: "Schlauen & Fressers", coords: "Lat: 21.5 / Lon: 27.2", img: "https://i.postimg.cc/zf3ggGcH/Bild-2024-07-30-202836983.png" },
                        { title: "South Ice Cave", type: "Artefakt", sub: "Himmelsherren/Skylord", coords: "Lat: 59.7 / Lon: 20.3", img: "https://i.postimg.cc/bNWMM37Z/Bild-2024-07-30-203944019.png" },
                        { title: "Deepsea", type: "Artefakt", sub: "Brutalen/Brute", coords: "Lat: 67.1 / Lon: 88.8", img: "https://i.postimg.cc/9QmGVqvy/Bild-2024-07-30-204912302.png" },
                        { title: "Underground World", type: "Artefakt", sub: "Rudels/Pack", coords: "Lat: 54 / Lon: 49", img: "https://i.postimg.cc/jqzGDGFt/Bild-2024-07-30-205903203.png" },
                        { title: "Jungle Cave", type: "Artefakt", sub: "Immunen/Immune", coords: "Lat: 46.8 / Lon: 58", img: "https://i.postimg.cc/vmkvN5Z5/Bild-2024-07-30-211537593.png" },
                        { title: "Sonnenhöhle", type: "Besonderer Ort", sub: "Eingang", coords: "Lat: 36.6 / Lon: 60.6", img: "https://i.postimg.cc/fyB0S0kV/Bild-2024-07-30-213359059.png" },
                        { title: "Sonnenhöhle", type: "Besonderer Ort", sub: "Eingang", coords: "Lat: 45.4 / Lon: 53.2", img: "https://i.postimg.cc/fbYnvGmN/Bild-2024-07-30-213913083.png" },
                        { title: "Sonnenhöhle", type: "Besonderer Ort", sub: "Eingang", coords: "Lat: 65.5 / Lon: 47.3", img: "https://i.postimg.cc/65k0130y/Bild-2024-08-01-202216681.png" },
                        { title: "Sonnenhöhle", type: "Besonderer Ort", sub: "Ausgang", coords: "Lat: 65.8 / Lon: 50.1", img: "https://i.postimg.cc/5NvXmq2Q/Bild-2024-08-01-203045224.png" },
                        { title: "Südliche Luftkuppel", type: "Besonderer Ort", sub: "", coords: "Lat: 65.4 / Lon: 59.5", img: "https://i.postimg.cc/Pr44d8Bc/Bild-2024-08-01-204937964.png" },
                        { title: "Südliche Luftkuppel", type: "Besonderer Ort", sub: "", coords: "Lat: 65.4 / Lon: 59.5", img: "https://i.postimg.cc/xTQ4nmdD/Bild-2024-08-01-205950452.png" },
                        { title: "Westliche Luftkuppel", type: "Besonderer Ort", sub: "", coords: "Lat: 27.5 / Lon: 82.5", img: "https://i.postimg.cc/3xtL7bkz/Bild-2024-08-01-210523406.png" },
                        { title: "Westliche Luftkuppel", type: "Besonderer Ort", sub: "", coords: "Lat: 27.5 / Lon: 82.5", img: "https://i.postimg.cc/RVyF8vRY/Bild-2024-08-01-210633287.png" }
                    ]
                },
                { 
                    name: "Scorched Earth", 
                    url: "https://arkmap.axi92.at/126c63dd-17c2-4770-8b86-b1c13121e445", 
                    pois: [
                        { title: "Öffentliche Ölfarm", type: "Teleporter", coords: "Lat: 59.5 / Lon: 77", img: "https://i.postimg.cc/JntyW8hQ/Bild-2024-05-16-143030551.png" },
                        { title: "Grüner Obelisk", type: "Teleporter", coords: "Lat: 50.5 / Lon: 75", img: "https://i.postimg.cc/3RDKBxRz/Bild-2024-05-16-142927878.png" },
                        { title: "Roter Obelisk", type: "Teleporter", coords: "Lat: 72 / Lon: 39.5", img: "https://i.postimg.cc/SsDKTxbr/Bild-2024-05-16-143219050.png" },
                        { title: "Blauer Obelisk", type: "Teleporter", coords: "Lat: 17 / Lon: 34", img: "https://i.postimg.cc/MGQXp5SC/Bild-2024-05-16-142802082.png" },
                        { title: "Wyvern Falle Südwest", type: "Besonderer Ort", sub: "Öffentlich", coords: "Lat: 70.5 / Lon: 15.5", img: "https://i.postimg.cc/3J7znFx3/Bild-2024-05-16-143627729.png" },
                        { title: "Wyvern Falle West", type: "Besonderer Ort", sub: "Öffentlich", coords: "Lat: 56.5 / Lon: 12.5", img: "https://i.postimg.cc/vT3RW49r/Bild-2024-05-16-143808360.png" },
                        { title: "Wyvern Falle Nordwest", type: "Besonderer Ort", sub: "Öffentlich", coords: "Lat: 34 / Lon: 8", img: "https://i.postimg.cc/MpcTpw2P/Bild-2024-05-16-143932986.png" }
                    ]
                },
                { 
                    name: "Aberration", 
                    url: "https://arkmap.axi92.at/cb9a2f61-1171-42d4-a7a3-8996f2e61640", 
                    pois: [
                        { title: "Öffentliche Harzfarm", type: "Teleporter", coords: "Lat: 26 / Lon: 49", img: "https://i.postimg.cc/br9FW8GF/Bild-2024-09-15-114714323.png" },
                        { title: "Öffentliche Gasfarm", type: "Teleporter", coords: "Lat: 26 / Lon: 49", img: "https://i.postimg.cc/Y2GzDQLK/Bild-2024-09-15-114928119.png" },
                        { title: "Öffentliche Reaper-Falle", type: "Teleporter", coords: "Lat: 61.3 / Lon: 72", img: "https://i.postimg.cc/SNd9jPhn/Bild-2025-03-15-153702775.png" },
                        { title: "Old Railway Cave", type: "Artefakt", sub: "Tiefe/Depths", coords: "Lat: 48 / Lon: 28", img: "https://i.postimg.cc/d3gdxDPv/Bild-2024-09-15-125701027.png" },
                        { title: "Hidden Grotto Cave", type: "Artefakt", sub: "Schatten/Shadows", coords: "Lat: 55 / Lon: 66", img: "https://i.postimg.cc/Y23mLpXh/Bild-2024-09-15-131025238.png" },
                        { title: "Element Vault Cave", type: "Artefakt", sub: "Pirschens/Stalker", coords: "Lat: 80.5 / Lon: 45.8", img: "https://i.postimg.cc/dVh5hK1b/Bild-2024-09-15-124725471.png" },
                        { title: "Westlicher Aufgang", type: "Besonderer Ort", sub: "Roter Obelisk", coords: "Lat: 51.7 / Lon: 21.6", img: "https://i.postimg.cc/qvvzLbrx/Bild-2024-09-15-123339109.png" },
                        { title: "Südwestlicher Aufgang", type: "Besonderer Ort", sub: "Roter Obelisk", coords: "Lat: 78 / Lon: 29", img: "https://i.postimg.cc/vHr3wmpZ/Bild-2024-09-15-123947145.png" },
                        { title: "Nordöstlicher Aufgang", type: "Besonderer Ort", sub: "Grüner Obelisk", coords: "Lat: 27 / Lon: 63", img: "https://i.postimg.cc/wBDyyK20/Bild-2024-09-15-121624761.png" },
                        { title: "Nordöstlicher Aufgang", type: "Besonderer Ort", sub: "Grüner Obelisk", coords: "Lat: 40.5 / Lon: 79", img: "https://i.postimg.cc/LXWC01dy/Bild-2024-09-15-122517143.png" },
                        { title: "Nordwestlicher Aufgang", type: "Besonderer Ort", sub: "Blauer Obelisk", coords: "Lat: 19.3 / Lon: 27.9", img: "https://i.postimg.cc/Twh0v3fp/Bild-2024-09-15-121318783.png" },
                        { title: "Bossterminal Rockdrake", type: "Besonderer Ort", sub: "Schlucht", coords: "Lat: 42.7 / Lon: 36.8", img: "https://i.postimg.cc/43xh1jmX/Bild-2024-09-15-132004280.png" },
                        { title: "Rockdrake Schlucht", type: "Besonderer Ort", sub: "", coords: "Lat: 56.4 / Lon: 56.6", img: "https://i.postimg.cc/k5syYSQK/Bild-2024-09-15-132250980.png" }
                    ]
                },
                { 
                    name: "Extinction", 
                    url: "https://arkmap.axi92.at/f9384885-6f6e-45ac-ae2f-027f87cb0122", 
                    pois: [
                        { title: "City Terminal", type: "Teleporter", coords: "Lat: 50.7 / Lon: 36.7", img: "https://i.postimg.cc/50w0xq9T/Bild-2025-01-19-131143331.png" },
                        { title: "SE Biom", type: "Teleporter", coords: "Lat: 85.5 / Lon: 86.2", img: "https://i.postimg.cc/7YTwnLDZ/Bild-2025-01-19-125304820.png" },
                        { title: "Underground", type: "Teleporter", coords: "Lat: 23.5 / Lon: 18", img: "https://i.postimg.cc/bwc2jJRZ/Bild-2025-01-19-131536796.png" },
                        { title: "Schnee Biom", type: "Teleporter", coords: "Lat: 18.2 / Lon: 81.3", img: "https://i.postimg.cc/NF3p1tv5/Bild-2025-01-19-131351367.png" },
                        { title: "Forest Cave", type: "Artefakt", sub: "Wachstums/Growth", coords: "Lat: 5.5 / Lon: 35.8", img: "https://i.postimg.cc/50Tk4Lyc/Bild-2025-01-19-131732899.png" },
                        { title: "Desert Cave", type: "Artefakt", sub: "Chaos", coords: "Lat: 93 / Lon: 74", img: "https://i.postimg.cc/76h0BRxD/Bild-2025-01-19-132519654.png" },
                        { title: "Ice Cave", type: "Artefakt", sub: "Leere/Void", coords: "Lat: 15 / Lon: 63", img: "https://i.postimg.cc/vT1jdXvw/Bild-2025-01-19-132922835.png" }
                    ]
                },
                { 
                    name: "Ragnarok", 
                    url: "https://arkmap.axi92.at/1e1c1f9a-283d-4e23-9505-0abe717cd2ff", 
                    pois: [
                         { title: "Grüner Obelisk", type: "Teleporter", coords: "Lat: 57 / Lon: 39", img: "https://i.postimg.cc/pTVYxVjP/Bild-2025-07-08-231557928.png" },
                         { title: "Blauer Obelisk", type: "Teleporter", coords: "Lat: 18.7 / Lon: 18", img: "https://i.postimg.cc/PxQhcwvr/Bild-2025-07-08-232913973.png" },
                         { title: "Roter Obelisk", type: "Teleporter", coords: "Lat: 35.7 / Lon: 84.9", img: "https://i.postimg.cc/6qdTjgWF/Bild-2025-07-08-232357128.png" },
                         { title: "Öffentliche Harzfarm", type: "Teleporter", coords: "Lat: 60.5 / Lon: 40.5", img: "https://i.postimg.cc/25cz5Ttg/Bild-2025-07-08-230813181.png" },
                         { title: "Öffentliche Ölfarm", type: "Teleporter", coords: "Lat: 39 / Lon: 45", img: "https://i.postimg.cc/JhGLrzYM/Bild-2025-07-08-234811998.png" },
                         { title: "Öffentliche Wyvern Falle", type: "Besonderer Ort", coords: "Lat: 21.7 / Lon: 72", img: "https://i.postimg.cc/Nf6SRY8c/Bild-2025-07-09-010545987.png" },
                         { title: "Oluf Jungle Cave", type: "Artefakt", sub: "Jägers/Hunter", coords: "Lat: 18.6 / Lon: 27.8", img: "https://i.postimg.cc/rm1gKBPp/Bild-2025-07-09-014751706.jpg", miniBoss: "Lava Golem" },
                         { title: "Carnivorous Caverns", type: "Artefakt", sub: "Immunen & List", coords: "Lat: 21.9 / Lon: 42.1", img: "https://i.postimg.cc/FzpKsx56/Bild-2025-07-09-020329030.png" },
                         { title: "Frozen Dungeon", type: "Artefakt", sub: "Rudels/Pack", coords: "Lat: 31 / Lon: 37.8", img: "https://i.postimg.cc/PrnsVDZG/Bild-2025-07-09-022338880.jpg", miniBoss: "Ice Queen" },
                         { title: "Life's Labyrinth", type: "Artefakt", sub: "Multi (4)", coords: "Lat: 51.7 / Lon: 77.8", img: "https://i.postimg.cc/Y0Tpd2gp/Bild-2025-07-09-022647310.jpg" },
                         { title: "Tuso Trench", type: "Artefakt", sub: "Fressers/Devourer", coords: "Lat: 47 / Lon: 2.5", img: "https://i.postimg.cc/66Dmc4Sk/Bild-2025-07-09-024331789-1.jpg" },
                         { title: "Wyvern Cave/Trench", type: "Artefakt", sub: "Stärke/Strong", coords: "Lat: 69 / Lon: 42.1", img: "https://i.postimg.cc/MpkXz5L9/Bild-2025-07-09-024700432.jpg" }
                    ]
                },
                { 
                    name: "Valguero", 
                    url: "https://arkmap.axi92.at/0d77d17e-34f7-4dfe-b849-2e4bc174cd6e", 
                    pois: [
                        { title: "Blauer Obelisk", type: "Teleporter", coords: "Lat: 11 / Lon: 19", img: "https://i.postimg.cc/pdndxQLW/image.png" },
                        { title: "Roter Obelisk", type: "Teleporter", coords: "Lat: 75 / Lon: 17", img: "https://i.postimg.cc/CdyNPs5v/image.png" },
                        { title: "Grüner Obelisk", type: "Teleporter", coords: "Lat: 50.6 / Lon: 76", img: "https://i.postimg.cc/DZxfPxCc/image.png" },
                        { title: "Öffentliche Harzfarm", type: "Teleporter", coords: "Lat: 83.3 / Lon: 50.2", img: "https://i.postimg.cc/VL5fwyg2/image.png" },
                        { title: "Öffentliche Ölfarm", type: "Teleporter", coords: "Lat: 49 / Lon: 19.5", img: "https://i.postimg.cc/02CBVr71/image.png" },
                        { title: "Whitecliff Caverns", type: "Artefakt", sub: "Himmelsherren/Skylord", coords: "Lat: 78.2 / Lon: 90.4", img: "https://i.postimg.cc/k58C066H/image.jpg" },
                        { title: "Boreal Forest Cave", type: "Artefakt", sub: "Felsens/Crag", coords: "Lat: 35 / Lon: 52.2", img: "https://i.postimg.cc/fT9htSC2/image.jpg" },
                        { title: "Lost Temple", type: "Artefakt", sub: "Brutalen & Fressers", coords: "Lat: 46.8 / Lon: 87.4", img: "https://i.postimg.cc/sDdZZ7yQ/image-1.jpg" },
                        { title: "Snow Mountains Cave", type: "Artefakt", sub: "List & Zerstörers", coords: "Lat: 15.6 / Lon: 27.5", img: "https://i.postimg.cc/wvtZn3WB/image-1.jpg" },
                        { title: "The Liar", type: "Artefakt", sub: "Rudels, Stärke, Immunen", coords: "Lat: 73.8 / Lon: 41.8", img: "https://i.postimg.cc/XNHBQmwH/image-2.jpg" },
                        { title: "The Emerald Forest", type: "Artefakt", sub: "Torwächters/Gatekeeper", coords: "Lat: 37.9 / Lon: 57.8", img: "https://i.postimg.cc/2yVQ0DyH/image.jpg" },
                        { title: "Brutmutter Lystrix", type: "Worldboss", coords: "Lat: 74 / Lon: 42.5", img: "https://i.postimg.cc/hGMKKJbN/image.png" }
                    ]
                },
                { name: "Astraeos", url: "https://arkmap.axi92.at/6b719b3d-f04c-47f5-beb6-a5a0b1260e7c", pois: [] },
                { name: "Svartalfheim", url: "https://arkmap.axi92.at/581b1a31-d430-415e-97c5-be02d713d369", pois: [] },
                { name: "Lost Colony", url: "https://arkmap.axi92.at/85b59c62-b7bd-42d9-a976-7dd5e682b37b", pois: [] }
            ],
            "season": [
                { name: "IOP Adventures", url: "https://arkmap.axi92.at/1f471511-0845-400b-a547-8b2053784c20", pois: [] }
            ],
            "overhaul": [
                { name: "Primal Nemesis", url: "https://arkmap.axi92.at/1c2177f1-635c-478d-bbee-08359416beef", pois: [] },
                { name: "Primal Chaos", url: "https://arkmap.axi92.at/ada947db-fa4c-48ec-9477-185808943b8f", pois: [] }
            ]
        };

        // RENDER SIDEBAR
        function renderSidebar() {
            const sidebar = document.getElementById('mapSidebar');
            let html = `
                <div class="sidebar-header">
                    <h2 class="sidebar-title">Live Map Explorer</h2>
                    <div class="sidebar-subtitle">Wähle eine Karte</div>
                </div>`;

            const createButtons = (groupKey, title) => {
                html += `<div class="group-header">${title}</div>`;
                mapData[groupKey].forEach((map, index) => {
                    const id = `map-${groupKey}-${index}`;
                    html += `
                    <button id="${id}" class="map-btn" onclick="selectMap('${groupKey}', ${index}, this)">
                        <span>${map.name}</span> <span class="status-dot"></span>
                    </button>`;
                });
            };

            createButtons("official", "IOP Official Cluster");
            createButtons("season", "Season Server");
            createButtons("overhaul", "Overhaul's");

            sidebar.innerHTML = html;
        }

        // SCROLL FUNCTION FOR SLIDER
        function scrollSlider(btn, direction) {
            const wrapper = btn.closest('.poi-slider-wrapper');
            const slider = wrapper.querySelector('.poi-slider');
            const scrollAmount = 300; 
            slider.scrollBy({ left: scrollAmount * direction, behavior: 'smooth' });
            
            setTimeout(() => updateArrows(slider), 350); 
        }
        
        // UPDATE ARROWS VISIBILITY
        function updateArrows(slider) {
            const wrapper = slider.closest('.poi-slider-wrapper');
            if (!wrapper) return;
            
            const prev = wrapper.querySelector('.prev');
            const next = wrapper.querySelector('.next');
            
            if (window.innerWidth <= 768) {
                prev.style.display = 'none';
                next.style.display = 'none';
                return;
            }

            const tolerance = 2; 
            const maxScroll = slider.scrollWidth - slider.clientWidth;

            if (maxScroll <= 0) {
                prev.style.display = 'none';
                next.style.display = 'none';
            } else {
                prev.style.display = slider.scrollLeft > tolerance ? 'flex' : 'none';
                next.style.display = slider.scrollLeft < maxScroll - tolerance ? 'flex' : 'none';
            }
        }

        // SELECT MAP LOGIC
        function selectMap(groupKey, index, buttonElement) {
            document.querySelectorAll('.map-btn').forEach(btn => btn.classList.remove('active'));
            buttonElement.classList.add('active');

            const map = mapData[groupKey][index];
            const iframe = document.getElementById('mapFrame');
            const loader = document.getElementById('loader');
            const poiSection = document.getElementById('poiSection');
            const poiContainer = document.getElementById('poiContainer');

            // 1. Map laden
            loader.style.display = 'block';
            iframe.src = map.url;
            iframe.onload = function() { loader.style.display = 'none'; };

            // 2. POIs gruppieren und Slider erstellen
            if (map.pois && map.pois.length > 0) {
                poiSection.style.display = 'block';
                poiContainer.innerHTML = ''; 

                const groups = {};
                map.pois.forEach(poi => {
                    let groupName = poi.type.split(':')[0].trim(); 
                    if(groupName.includes("Artefakt")) groupName = "Artefakte";
                    if(groupName.includes("Teleporter")) groupName = "Teleporter";
                    
                    if (!groups[groupName]) groups[groupName] = [];
                    groups[groupName].push(poi);
                });

                for (const [groupName, items] of Object.entries(groups)) {
                    // Erstelle Slider-Struktur
                    const groupHtml = `
                        <div class="poi-category-header">${groupName}</div>
                        <div class="poi-slider-wrapper">
                            <button class="slider-arrow prev" onclick="scrollSlider(this, -1)">&#10094;</button>
                            <div class="poi-slider">
                                ${items.map((poi, i) => `
                                    <div class="poi-card" onclick="openModal('${groupKey}', ${index}, '${groupName}', ${i})">
                                        <img src="${poi.img}" class="poi-image" loading="lazy" alt="${poi.title}">
                                        <div class="poi-info">
                                            <span class="poi-type">${poi.sub || poi.type}</span>
                                            <div class="poi-title">${poi.title}</div>
                                            <div class="poi-coords">${poi.coords}</div>
                                            ${poi.miniBoss ? `<div class="poi-subtext" style="color:#FF9800;">Mini Boss: ${poi.miniBoss}</div>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="slider-arrow next" onclick="scrollSlider(this, 1)">&#10095;</button>
                        </div>
                    `;
                    poiContainer.innerHTML += groupHtml;
                }
                
                // Initialize arrow visibility for new sliders
                const sliders = poiContainer.querySelectorAll('.poi-slider');
                sliders.forEach(slider => {
                    slider.addEventListener('scroll', () => updateArrows(slider));
                    setTimeout(() => updateArrows(slider), 50);
                });

            } else {
                poiSection.style.display = 'none';
                poiContainer.innerHTML = '';
            }
        }

        // --- MODAL FUNKTIONEN ---
        function openModal(groupKey, mapIndex, groupName, poiIndex) {
            const map = mapData[groupKey][mapIndex];
            
            // Wir filtern genau wie oben im Loop, um die richtige Gruppe zu finden
            const groups = {};
            map.pois.forEach(p => {
                let gName = p.type.split(':')[0].trim(); 
                if(gName.includes("Artefakt")) gName = "Artefakte";
                if(gName.includes("Teleporter")) gName = "Teleporter";
                if (!groups[gName]) groups[gName] = [];
                groups[gName].push(p);
            });
            
            const poi = groups[groupName][poiIndex];
            
            if(poi) {
                document.getElementById('modalImg').src = poi.img;
                document.getElementById('modalType').textContent = poi.sub || poi.type;
                document.getElementById('modalTitle').textContent = poi.title;
                document.getElementById('modalCoords').textContent = poi.coords;
                
                // Modal öffnen
                const modal = document.getElementById('poiModal');
                modal.classList.add('active');
            }
        }

        function closeModal(event) {
            document.getElementById('poiModal').classList.remove('active');
        }

        // Global Resize Listener
        window.addEventListener('resize', () => {
            document.querySelectorAll('.poi-slider').forEach(updateArrows);
        });

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            renderSidebar();
            const firstButton = document.getElementById('map-official-0');
            if (firstButton) {
                selectMap('official', 0, firstButton);
            }
        });
    </script>

</body>
</html>
